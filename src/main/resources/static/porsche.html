<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>APEX MOTORS — Performance Collection</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;1,9..40,300&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet"/>
  <style>
    /* ───────────────────────────────────────────────
       DESIGN TOKENS
    ──────────────────────────────────────────────── */
    :root {
      --bg:       #0a0a0b;
      --bg2:      #111114;
      --bg3:      #18181c;
      --border:   rgba(255,255,255,0.08);
      --border2:  rgba(255,255,255,0.14);
      --text:     #f0f0ee;
      --muted:    #8a8a8e;
      --accent:   #e63312;
      --accent2:  #ff6344;
      --gold:     #c9a84c;
      --white:    #ffffff;
      --font-display: 'Bebas Neue', sans-serif;
      --font-body:    'DM Sans', sans-serif;
      --font-mono:    'DM Mono', monospace;
      --radius:   4px;
      --radius-lg: 8px;
      --ease:     cubic-bezier(0.22, 1, 0.36, 1);
    }

    /* ───────────────────────────────────────────────
       RESET & BASE
    ──────────────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-body);
      font-size: 15px;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }
    a { color: inherit; text-decoration: none; }
    button { cursor: pointer; font-family: inherit; border: none; background: none; }
    input, select, textarea { font-family: inherit; }
    img { display: block; max-width: 100%; }

    /* ───────────────────────────────────────────────
       SCROLLBAR
    ──────────────────────────────────────────────── */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 2px; }

    /* ───────────────────────────────────────────────
       NAV
    ──────────────────────────────────────────────── */
    nav {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 40px;
      height: 64px;
      background: rgba(10,10,11,0.7);
      backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid var(--border);
      transition: background 0.3s;
    }
    .nav-brand {
      display: flex; align-items: center; gap: 12px;
    }
    .nav-logo {
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
    }
    .nav-logo svg { width: 100%; height: 100%; }
    .brand-name {
      font-family: var(--font-display);
      font-size: 22px;
      letter-spacing: 0.12em;
      color: var(--white);
    }
    .brand-tagline {
      font-size: 9px;
      letter-spacing: 0.22em;
      color: var(--muted);
      text-transform: uppercase;
      margin-top: -2px;
    }
    .nav-links {
      display: flex; align-items: center; gap: 32px;
      list-style: none;
    }
    .nav-links a {
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--muted);
      transition: color 0.2s;
      position: relative;
    }
    .nav-links a:hover, .nav-links a.active { color: var(--white); }
    .nav-links a.active::after {
      content: '';
      position: absolute; bottom: -4px; left: 0; right: 0;
      height: 1px; background: var(--accent);
    }
    .nav-cta {
      background: var(--accent);
      color: var(--white) !important;
      padding: 8px 20px !important;
      border-radius: var(--radius);
      font-weight: 500;
      transition: background 0.2s !important;
    }
    .nav-cta:hover { background: var(--accent2) !important; }
    .nav-cta::after { display: none !important; }

    /* ───────────────────────────────────────────────
       PAGES (router)
    ──────────────────────────────────────────────── */
    .page { display: none; min-height: 100vh; padding-top: 64px; }
    .page.active { display: block; animation: fadeUp 0.45s var(--ease) both; }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(18px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ───────────────────────────────────────────────
       HERO
    ──────────────────────────────────────────────── */
    .hero {
      position: relative; overflow: hidden;
      height: calc(100vh - 64px);
      min-height: 520px;
      display: flex; align-items: flex-end;
      padding: 0 60px 80px;
    }
    .hero-bg {
      position: absolute; inset: 0;
      background:
        radial-gradient(ellipse 80% 60% at 70% 40%, rgba(230,51,18,0.12) 0%, transparent 65%),
        radial-gradient(ellipse 50% 80% at 20% 80%, rgba(201,168,76,0.06) 0%, transparent 60%),
        linear-gradient(160deg, #0d0d10 0%, #0a0a0b 60%, #12080a 100%);
    }
    .hero-grid {
      position: absolute; inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.025) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.025) 1px, transparent 1px);
      background-size: 60px 60px;
      mask-image: linear-gradient(to bottom, transparent 0%, black 30%, black 70%, transparent 100%);
    }
    .hero-number {
      position: absolute; right: 60px; top: 50%;
      transform: translateY(-50%);
      font-family: var(--font-display);
      font-size: clamp(180px, 22vw, 320px);
      line-height: 1;
      color: rgba(255,255,255,0.03);
      letter-spacing: -0.04em;
      user-select: none;
      pointer-events: none;
    }
    .hero-content { position: relative; z-index: 2; max-width: 700px; }
    .hero-eyebrow {
      display: inline-flex; align-items: center; gap: 10px;
      font-size: 10px; letter-spacing: 0.28em; text-transform: uppercase;
      color: var(--accent); margin-bottom: 20px;
    }
    .hero-eyebrow::before {
      content: ''; display: block;
      width: 32px; height: 1px; background: var(--accent);
    }
    .hero-title {
      font-family: var(--font-display);
      font-size: clamp(52px, 7vw, 100px);
      line-height: 0.95;
      letter-spacing: 0.02em;
      color: var(--white);
      margin-bottom: 24px;
    }
    .hero-title em {
      font-style: normal;
      color: transparent;
      -webkit-text-stroke: 1px rgba(255,255,255,0.25);
    }
    .hero-sub {
      font-size: 15px; color: var(--muted);
      max-width: 420px; line-height: 1.7;
      margin-bottom: 40px;
    }
    .hero-actions { display: flex; gap: 16px; align-items: center; }
    .btn-primary {
      background: var(--accent);
      color: var(--white);
      padding: 14px 32px;
      border-radius: var(--radius);
      font-size: 11px; font-weight: 500;
      letter-spacing: 0.16em; text-transform: uppercase;
      transition: all 0.25s var(--ease);
      border: 1px solid transparent;
    }
    .btn-primary:hover {
      background: transparent;
      border-color: var(--accent);
      color: var(--accent);
      transform: translateY(-1px);
    }
    .btn-ghost {
      background: transparent;
      color: var(--muted);
      padding: 14px 32px;
      border-radius: var(--radius);
      font-size: 11px; font-weight: 400;
      letter-spacing: 0.16em; text-transform: uppercase;
      border: 1px solid var(--border2);
      transition: all 0.25s var(--ease);
    }
    .btn-ghost:hover { color: var(--white); border-color: rgba(255,255,255,0.3); }
    .hero-stats {
      position: absolute; bottom: 80px; right: 60px; z-index: 2;
      display: flex; gap: 40px;
    }
    .stat { text-align: right; }
    .stat-value {
      font-family: var(--font-display);
      font-size: 36px; color: var(--white);
      line-height: 1;
    }
    .stat-label {
      font-size: 9px; letter-spacing: 0.2em;
      text-transform: uppercase; color: var(--muted);
      margin-top: 4px;
    }
    .hero-scroll {
      position: absolute; bottom: 30px; left: 50%;
      transform: translateX(-50%);
      display: flex; flex-direction: column; align-items: center;
      gap: 8px; z-index: 2;
    }
    .scroll-text { font-size: 9px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); }
    .scroll-line {
      width: 1px; height: 40px;
      background: linear-gradient(to bottom, var(--muted), transparent);
      animation: scrollPulse 2s ease-in-out infinite;
    }
    @keyframes scrollPulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 1; }
    }

    /* ───────────────────────────────────────────────
       CATALOG PAGE
    ──────────────────────────────────────────────── */
    .catalog-header {
      padding: 60px 60px 0;
      display: flex; align-items: flex-end; justify-content: space-between;
      gap: 20px; flex-wrap: wrap;
    }
    .section-label {
      font-size: 9px; letter-spacing: 0.28em; text-transform: uppercase;
      color: var(--accent); margin-bottom: 10px;
      display: flex; align-items: center; gap: 8px;
    }
    .section-label::before {
      content: ''; display: block; width: 20px; height: 1px; background: var(--accent);
    }
    .section-title {
      font-family: var(--font-display);
      font-size: clamp(36px, 4vw, 56px);
      letter-spacing: 0.04em; line-height: 1;
      color: var(--white);
    }
    .catalog-count {
      font-family: var(--font-mono);
      font-size: 12px; color: var(--muted);
      padding-bottom: 6px;
    }

    /* FILTERS */
    .filters-bar {
      margin: 32px 60px 0;
      padding: 20px 24px;
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      display: flex; gap: 16px; flex-wrap: wrap; align-items: flex-end;
    }
    .filter-group { display: flex; flex-direction: column; gap: 6px; min-width: 140px; flex: 1; }
    .filter-label {
      font-size: 9px; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted);
    }
    .filter-input {
      background: var(--bg3);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 12px;
      border-radius: var(--radius);
      font-size: 13px;
      outline: none;
      transition: border-color 0.2s;
      width: 100%;
    }
    .filter-input:focus { border-color: var(--accent); }
    .filter-input::placeholder { color: var(--muted); }
    .filter-row { display: flex; gap: 8px; align-items: center; }
    .filter-row .filter-input { flex: 1; min-width: 60px; }
    .filter-sep { color: var(--muted); font-size: 12px; flex-shrink: 0; }
    .filters-actions { display: flex; gap: 8px; align-items: flex-end; }
    .btn-sm {
      padding: 8px 16px;
      border-radius: var(--radius);
      font-size: 10px; letter-spacing: 0.14em; text-transform: uppercase; font-weight: 500;
      transition: all 0.2s;
    }
    .btn-sm.primary { background: var(--accent); color: var(--white); }
    .btn-sm.primary:hover { background: var(--accent2); }
    .btn-sm.secondary { background: var(--bg3); color: var(--muted); border: 1px solid var(--border); }
    .btn-sm.secondary:hover { color: var(--white); border-color: var(--border2); }

    /* SORT BAR */
    .sort-bar {
      padding: 16px 60px;
      display: flex; align-items: center; justify-content: space-between; gap: 16px;
    }
    .sort-options { display: flex; gap: 4px; }
    .sort-btn {
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 11px; color: var(--muted);
      border: 1px solid transparent;
      transition: all 0.2s;
    }
    .sort-btn:hover { color: var(--white); }
    .sort-btn.active { color: var(--white); border-color: var(--border2); background: var(--bg3); }
    .view-count { font-family: var(--font-mono); font-size: 11px; color: var(--muted); }

    /* GRID */
    .cars-grid {
      padding: 0 60px 100px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 24px;
    }

    /* CARD */
    .car-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.35s var(--ease), border-color 0.25s, box-shadow 0.35s var(--ease);
      animation: cardIn 0.5s var(--ease) both;
    }
    .car-card:hover {
      transform: translateY(-6px);
      border-color: var(--border2);
      box-shadow: 0 24px 48px rgba(0,0,0,0.5), 0 0 0 1px rgba(230,51,18,0.1);
    }
    @keyframes cardIn {
      from { opacity: 0; transform: translateY(24px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .card-image-wrap {
      position: relative; overflow: hidden;
      aspect-ratio: 16/9;
      background: var(--bg3);
    }
    .card-image {
      width: 100%; height: 100%; object-fit: cover;
      transition: transform 0.6s var(--ease);
    }
    .car-card:hover .card-image { transform: scale(1.04); }
    .card-image-placeholder {
      position: absolute; inset: 0;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      gap: 12px; color: var(--bg);
      background: linear-gradient(135deg, #1a1a20 0%, #111115 100%);
    }
    .card-image-placeholder svg { opacity: 0.3; }
    .card-badge {
      position: absolute; top: 12px; left: 12px;
      background: rgba(10,10,11,0.85);
      backdrop-filter: blur(8px);
      border: 1px solid var(--border2);
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 10px; letter-spacing: 0.14em; text-transform: uppercase; color: var(--muted);
    }
    .card-body { padding: 20px; }
    .card-year { font-family: var(--font-mono); font-size: 11px; color: var(--accent); margin-bottom: 4px; }
    .card-model { font-family: var(--font-display); font-size: 26px; letter-spacing: 0.04em; color: var(--white); line-height: 1.1; }
    .card-trim { font-size: 12px; color: var(--muted); margin-top: 2px; letter-spacing: 0.06em; }
    .card-specs {
      display: flex; gap: 0; margin: 16px 0;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }
    .spec-item {
      flex: 1; padding: 10px 8px; text-align: center;
      border-right: 1px solid var(--border);
      background: var(--bg3);
      transition: background 0.2s;
    }
    .spec-item:last-child { border-right: none; }
    .car-card:hover .spec-item { background: rgba(230,51,18,0.04); }
    .spec-val { font-family: var(--font-mono); font-size: 13px; color: var(--text); font-weight: 400; }
    .spec-key { font-size: 9px; letter-spacing: 0.14em; text-transform: uppercase; color: var(--muted); margin-top: 2px; }
    .card-footer {
      display: flex; align-items: center; justify-content: space-between;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    .card-price {
      font-family: var(--font-display);
      font-size: 28px; color: var(--white); letter-spacing: 0.02em;
    }
    .card-color {
      display: flex; align-items: center; gap: 6px;
      font-size: 11px; color: var(--muted);
    }
    .color-dot {
      width: 10px; height: 10px; border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.15);
      flex-shrink: 0;
    }
    .card-arrow {
      width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      border: 1px solid var(--border2);
      border-radius: 50%;
      color: var(--muted);
      transition: all 0.2s;
      margin-left: 8px;
    }
    .car-card:hover .card-arrow {
      background: var(--accent); border-color: var(--accent); color: var(--white);
    }

    /* SKELETON */
    .skeleton { animation: shimmer 1.5s ease-in-out infinite; }
    @keyframes shimmer {
      0%, 100% { opacity: 0.4; }
      50%       { opacity: 0.8; }
    }
    .skel-card {
      background: var(--bg2); border: 1px solid var(--border);
      border-radius: var(--radius-lg); overflow: hidden;
    }
    .skel-img { aspect-ratio: 16/9; background: var(--bg3); }
    .skel-body { padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    .skel-line { background: var(--bg3); border-radius: 4px; }

    /* EMPTY STATE */
    .empty-state {
      grid-column: 1/-1;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 80px 20px; gap: 20px; text-align: center;
    }
    .empty-state svg { opacity: 0.2; }
    .empty-title { font-family: var(--font-display); font-size: 32px; color: var(--muted); letter-spacing: 0.06em; }
    .empty-sub { font-size: 13px; color: var(--muted); max-width: 300px; }

    /* ───────────────────────────────────────────────
       DETAIL PAGE
    ──────────────────────────────────────────────── */
    .detail-hero {
      position: relative; height: 55vh; min-height: 360px;
      overflow: hidden; background: var(--bg2);
    }
    .detail-hero-img {
      width: 100%; height: 100%; object-fit: cover;
      opacity: 0.7;
    }
    .detail-hero-overlay {
      position: absolute; inset: 0;
      background: linear-gradient(to top, var(--bg) 0%, rgba(10,10,11,0.3) 60%, transparent 100%);
    }
    .detail-hero-placeholder {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, #111116 0%, #0d0d10 100%);
    }
    .detail-content { padding: 0 60px 80px; margin-top: -60px; position: relative; z-index: 2; }
    .detail-top {
      display: flex; align-items: flex-end; justify-content: space-between;
      gap: 24px; flex-wrap: wrap; margin-bottom: 40px;
    }
    .detail-model { font-family: var(--font-display); font-size: clamp(40px, 5vw, 72px); color: var(--white); letter-spacing: 0.03em; line-height: 1; }
    .detail-trim { font-size: 14px; color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase; margin-top: 6px; }
    .detail-year-badge {
      display: inline-block; font-family: var(--font-mono); font-size: 11px;
      color: var(--accent); border: 1px solid var(--accent);
      padding: 4px 12px; border-radius: 999px; margin-bottom: 8px;
    }
    .detail-price {
      font-family: var(--font-display); font-size: 48px; color: var(--white); letter-spacing: 0.02em; line-height: 1;
    }
    .detail-price-label { font-size: 10px; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); margin-top: 4px; }
    .detail-actions { display: flex; gap: 12px; margin-top: 16px; }
    .btn-edit {
      display: flex; align-items: center; gap: 8px;
      padding: 12px 24px; border-radius: var(--radius);
      border: 1px solid var(--border2); color: var(--text);
      font-size: 11px; letter-spacing: 0.14em; text-transform: uppercase;
      transition: all 0.2s;
    }
    .btn-edit:hover { border-color: var(--gold); color: var(--gold); }
    .btn-delete {
      display: flex; align-items: center; gap: 8px;
      padding: 12px 24px; border-radius: var(--radius);
      border: 1px solid rgba(230,51,18,0.3); color: var(--accent);
      font-size: 11px; letter-spacing: 0.14em; text-transform: uppercase;
      transition: all 0.2s;
    }
    .btn-delete:hover { background: rgba(230,51,18,0.1); }
    .btn-back {
      display: inline-flex; align-items: center; gap: 8px;
      font-size: 11px; letter-spacing: 0.14em; text-transform: uppercase;
      color: var(--muted); padding: 16px 0 24px; transition: color 0.2s;
    }
    .btn-back:hover { color: var(--white); }

    /* SPECS TABLE */
    .specs-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1px; background: var(--border);
      border: 1px solid var(--border); border-radius: var(--radius-lg); overflow: hidden;
      margin-top: 32px;
    }
    .spec-cell {
      background: var(--bg2); padding: 20px 24px;
      transition: background 0.2s;
    }
    .spec-cell:hover { background: var(--bg3); }
    .spec-cell-key {
      font-size: 9px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); margin-bottom: 6px;
    }
    .spec-cell-val {
      font-family: var(--font-mono); font-size: 18px; color: var(--text);
    }

    /* ───────────────────────────────────────────────
       ADD/EDIT PAGE
    ──────────────────────────────────────────────── */
    .form-page { padding: 60px; max-width: 900px; margin: 0 auto; }
    .form-header { margin-bottom: 48px; }
    .form-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 24px;
    }
    .form-grid.full { grid-column: 1/-1; }
    .field { display: flex; flex-direction: column; gap: 8px; }
    .field.full { grid-column: 1/-1; }
    .field-label {
      font-size: 9px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted);
    }
    .field-input {
      background: var(--bg2);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 14px 16px;
      border-radius: var(--radius);
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      width: 100%;
      -webkit-appearance: none;
    }
    .field-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(230,51,18,0.1);
    }
    .field-input::placeholder { color: rgba(138,138,142,0.5); }
    .field-input.error { border-color: #e63312; }
    .field-error { font-size: 11px; color: var(--accent); margin-top: 2px; }
    .form-actions {
      margin-top: 40px; display: flex; gap: 12px; align-items: center;
      grid-column: 1/-1;
    }
    .btn-submit {
      background: var(--accent); color: var(--white);
      padding: 16px 40px; border-radius: var(--radius);
      font-size: 11px; font-weight: 500; letter-spacing: 0.18em; text-transform: uppercase;
      transition: all 0.25s var(--ease);
      display: flex; align-items: center; gap: 10px;
      border: 1px solid transparent;
    }
    .btn-submit:hover { background: transparent; border-color: var(--accent); color: var(--accent); }
    .btn-submit:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-cancel {
      color: var(--muted); font-size: 11px; letter-spacing: 0.14em;
      text-transform: uppercase; transition: color 0.2s;
      padding: 16px 20px;
    }
    .btn-cancel:hover { color: var(--white); }

    /* ───────────────────────────────────────────────
       MODAL
    ──────────────────────────────────────────────── */
    .modal-overlay {
      position: fixed; inset: 0; z-index: 200;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(8px);
      display: flex; align-items: center; justify-content: center; padding: 20px;
      opacity: 0; pointer-events: none; transition: opacity 0.25s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: all; }
    .modal {
      background: var(--bg2);
      border: 1px solid var(--border2);
      border-radius: var(--radius-lg);
      padding: 40px;
      max-width: 440px; width: 100%;
      transform: scale(0.94) translateY(10px);
      transition: transform 0.3s var(--ease);
    }
    .modal-overlay.open .modal { transform: scale(1) translateY(0); }
    .modal-icon {
      width: 52px; height: 52px;
      background: rgba(230,51,18,0.1);
      border: 1px solid rgba(230,51,18,0.2);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 20px;
      color: var(--accent);
    }
    .modal-title { font-family: var(--font-display); font-size: 28px; color: var(--white); margin-bottom: 8px; }
    .modal-body { font-size: 14px; color: var(--muted); line-height: 1.6; margin-bottom: 32px; }
    .modal-actions { display: flex; gap: 12px; }
    .modal-confirm {
      flex: 1; background: var(--accent); color: var(--white);
      padding: 12px 20px; border-radius: var(--radius);
      font-size: 11px; letter-spacing: 0.14em; text-transform: uppercase; font-weight: 500;
      transition: background 0.2s;
    }
    .modal-confirm:hover { background: var(--accent2); }
    .modal-cancel {
      flex: 1; background: var(--bg3); color: var(--muted);
      padding: 12px 20px; border-radius: var(--radius);
      font-size: 11px; letter-spacing: 0.14em; text-transform: uppercase;
      border: 1px solid var(--border); transition: all 0.2s;
    }
    .modal-cancel:hover { color: var(--white); }

    /* ───────────────────────────────────────────────
       TOASTS
    ──────────────────────────────────────────────── */
    #toast-container {
      position: fixed; top: 80px; right: 24px; z-index: 300;
      display: flex; flex-direction: column; gap: 10px;
      pointer-events: none;
    }
    .toast {
      background: var(--bg2);
      border: 1px solid var(--border2);
      border-radius: var(--radius-lg);
      padding: 14px 18px;
      min-width: 280px; max-width: 380px;
      display: flex; align-items: flex-start; gap: 12px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.5);
      animation: toastIn 0.4s var(--ease) both;
      pointer-events: all;
      border-left: 3px solid var(--accent);
    }
    .toast.success { border-left-color: #2dd4a0; }
    .toast.error   { border-left-color: var(--accent); }
    .toast.info    { border-left-color: var(--gold); }
    @keyframes toastIn {
      from { opacity: 0; transform: translateX(30px); }
      to   { opacity: 1; transform: translateX(0); }
    }
    @keyframes toastOut {
      to { opacity: 0; transform: translateX(30px); }
    }
    .toast-icon { flex-shrink: 0; margin-top: 1px; }
    .toast-content { flex: 1; }
    .toast-title { font-size: 13px; font-weight: 500; color: var(--white); margin-bottom: 2px; }
    .toast-msg { font-size: 12px; color: var(--muted); }

    /* ───────────────────────────────────────────────
       FOOTER
    ──────────────────────────────────────────────── */
    footer {
      border-top: 1px solid var(--border);
      padding: 32px 60px;
      display: flex; align-items: center; justify-content: space-between;
      gap: 16px; flex-wrap: wrap;
    }
    .footer-brand { font-family: var(--font-display); font-size: 18px; letter-spacing: 0.1em; color: var(--muted); }
    .footer-note { font-size: 11px; color: rgba(138,138,142,0.5); }

    /* ───────────────────────────────────────────────
       ERROR STATE
    ──────────────────────────────────────────────── */
    .api-error-banner {
      background: rgba(230,51,18,0.08);
      border: 1px solid rgba(230,51,18,0.2);
      border-radius: var(--radius);
      padding: 12px 20px; margin-bottom: 16px;
      font-size: 13px; color: var(--accent);
      display: flex; align-items: center; gap: 10px;
    }

    /* ───────────────────────────────────────────────
       SPINNER
    ──────────────────────────────────────────────── */
    .spinner {
      width: 16px; height: 16px;
      border: 2px solid rgba(255,255,255,0.2);
      border-top-color: var(--white);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      flex-shrink: 0;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ───────────────────────────────────────────────
       RESPONSIVE
    ──────────────────────────────────────────────── */
    @media (max-width: 768px) {
      nav { padding: 0 20px; }
      .nav-links { display: none; }
      .hero { padding: 0 24px 60px; }
      .hero-stats { right: 24px; gap: 20px; }
      .hero-number { display: none; }
      .catalog-header, .filters-bar, .sort-bar { padding-left: 20px; padding-right: 20px; }
      .cars-grid { padding: 0 20px 60px; }
      .detail-content { padding: 0 20px 60px; }
      .form-page { padding: 40px 20px; }
      .form-grid { grid-template-columns: 1fr; }
      footer { padding: 24px 20px; }
    }
  </style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="nav-brand">
    <div class="nav-logo">
      <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
        <polygon points="20,4 36,32 4,32" fill="none" stroke="#e63312" stroke-width="2"/>
        <polygon points="20,11 30,28 10,28" fill="rgba(230,51,18,0.15)" stroke="#e63312" stroke-width="1"/>
        <circle cx="20" cy="21" r="3" fill="#e63312"/>
      </svg>
    </div>
    <div>
      <div class="brand-name">APEX MOTORS</div>
      <div class="brand-tagline">Performance Collection</div>
    </div>
  </div>
  <ul class="nav-links">
    <li><a href="#" onclick="showPage('home')" id="nav-home" class="active">Home</a></li>
    <li><a href="#" onclick="showPage('catalog')" id="nav-catalog">Models</a></li>
    <li><a href="#" onclick="showPage('add')" id="nav-add" class="nav-cta">Add Vehicle</a></li>
  </ul>
</nav>

<!-- PAGES -->

<!-- HOME -->
<div class="page active" id="page-home">
  <section class="hero">
    <div class="hero-bg"></div>
    <div class="hero-grid"></div>
    <div class="hero-number">GT</div>
    <div class="hero-content">
      <div class="hero-eyebrow">Performance Collection 2024</div>
      <h1 class="hero-title">DRIVE<br/>BEYOND<br/><em>LIMITS</em></h1>
      <p class="hero-sub">Discover our curated collection of high-performance vehicles. Every machine engineered to deliver an unparalleled driving experience.</p>
      <div class="hero-actions">
        <button class="btn-primary" onclick="showPage('catalog')">Explore Collection</button>
        <button class="btn-ghost" onclick="showPage('add')">List a Vehicle</button>
      </div>
    </div>
    <div class="hero-stats" id="hero-stats">
      <div class="stat"><div class="stat-value" id="stat-count">—</div><div class="stat-label">Models</div></div>
      <div class="stat"><div class="stat-value" id="stat-brands">—</div><div class="stat-label">Variants</div></div>
    </div>
    <div class="hero-scroll">
      <div class="scroll-text">Scroll</div>
      <div class="scroll-line"></div>
    </div>
  </section>
  <footer>
    <div class="footer-brand">APEX MOTORS</div>
    <div class="footer-note">Performance Vehicle Registry — Built for enthusiasts</div>
  </footer>
</div>

<!-- CATALOG -->
<div class="page" id="page-catalog">
  <div class="catalog-header">
    <div>
      <div class="section-label">Our Fleet</div>
      <h2 class="section-title">ALL MODELS</h2>
    </div>
    <div class="catalog-count" id="catalog-count"></div>
  </div>

  <div class="filters-bar" id="filters-bar">
    <div class="filter-group" style="min-width:160px;">
      <div class="filter-label">Model Search</div>
      <input class="filter-input" type="text" id="f-model" placeholder="e.g. 911, Taycan…" oninput="applyFilters()"/>
    </div>
    <div class="filter-group">
      <div class="filter-label">Year Range</div>
      <div class="filter-row">
        <input class="filter-input" type="number" id="f-year-min" placeholder="From" oninput="applyFilters()"/>
        <span class="filter-sep">–</span>
        <input class="filter-input" type="number" id="f-year-max" placeholder="To" oninput="applyFilters()"/>
      </div>
    </div>
    <div class="filter-group">
      <div class="filter-label">Price Range (€)</div>
      <div class="filter-row">
        <input class="filter-input" type="number" id="f-price-min" placeholder="Min" oninput="applyFilters()"/>
        <span class="filter-sep">–</span>
        <input class="filter-input" type="number" id="f-price-max" placeholder="Max" oninput="applyFilters()"/>
      </div>
    </div>
    <div class="filter-group" style="min-width:120px;">
      <div class="filter-label">Color</div>
      <input class="filter-input" type="text" id="f-color" placeholder="Any color…" oninput="applyFilters()"/>
    </div>
    <div class="filters-actions">
      <button class="btn-sm secondary" onclick="clearFilters()">Clear</button>
    </div>
  </div>

  <div class="sort-bar">
    <div class="sort-options">
      <button class="sort-btn active" data-sort="default" onclick="setSort(this,'default')">Default</button>
      <button class="sort-btn" data-sort="price-asc" onclick="setSort(this,'price-asc')">Price ↑</button>
      <button class="sort-btn" data-sort="price-desc" onclick="setSort(this,'price-desc')">Price ↓</button>
      <button class="sort-btn" data-sort="year-desc" onclick="setSort(this,'year-desc')">Newest</button>
    </div>
    <div class="view-count" id="view-count"></div>
  </div>

  <div class="cars-grid" id="cars-grid">
    <!-- filled by JS -->
  </div>
  <footer>
    <div class="footer-brand">APEX MOTORS</div>
    <div class="footer-note">Performance Vehicle Registry</div>
  </footer>
</div>

<!-- DETAIL -->
<div class="page" id="page-detail">
  <div class="detail-hero" id="detail-hero">
    <div class="detail-hero-placeholder" id="detail-hero-placeholder">
      <svg width="120" height="60" viewBox="0 0 120 60" fill="none" opacity="0.15">
        <ellipse cx="60" cy="38" rx="54" ry="16" fill="white"/>
        <rect x="20" y="22" width="80" height="22" rx="6" fill="white"/>
        <rect x="30" y="14" width="30" height="14" rx="4" fill="white"/>
        <circle cx="32" cy="46" r="8" fill="#0a0a0b"/>
        <circle cx="88" cy="46" r="8" fill="#0a0a0b"/>
        <circle cx="32" cy="46" r="4" fill="white" opacity="0.4"/>
        <circle cx="88" cy="46" r="4" fill="white" opacity="0.4"/>
      </svg>
    </div>
    <img class="detail-hero-img" id="detail-hero-img" src="" alt="" style="display:none;"/>
    <div class="detail-hero-overlay"></div>
  </div>

  <div class="detail-content">
    <button class="btn-back" onclick="showPage('catalog')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
      Back to Collection
    </button>
    <div class="detail-top">
      <div>
        <div class="detail-year-badge" id="detail-year"></div>
        <div class="detail-model" id="detail-model"></div>
        <div class="detail-trim" id="detail-trim"></div>
      </div>
      <div>
        <div class="detail-price" id="detail-price"></div>
        <div class="detail-price-label">Starting Price</div>
        <div class="detail-actions">
          <button class="btn-edit" id="btn-edit">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            Edit
          </button>
          <button class="btn-delete" id="btn-delete-detail">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
            Delete
          </button>
        </div>
      </div>
    </div>
    <div class="specs-grid" id="detail-specs"></div>
  </div>
  <footer>
    <div class="footer-brand">APEX MOTORS</div>
    <div class="footer-note">Performance Vehicle Registry</div>
  </footer>
</div>

<!-- ADD/EDIT CAR -->
<div class="page" id="page-add">
  <div class="form-page">
    <div class="form-header">
      <button class="btn-back" onclick="cancelForm()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
        Back
      </button>
      <div class="section-label">Vehicle Registry</div>
      <h2 class="section-title" id="form-title">ADD VEHICLE</h2>
    </div>
    <div id="form-error" style="display:none;"></div>
    <form id="car-form" onsubmit="submitCar(event)">
      <div class="form-grid">
        <div class="field">
          <label class="field-label" for="f-model-in">Model *</label>
          <input class="field-input" id="f-model-in" name="model" placeholder="e.g. 911 Carrera" required minlength="2" maxlength="40"/>
          <div class="field-error" id="err-model"></div>
        </div>
        <div class="field">
          <label class="field-label" for="f-trim">Trim Level *</label>
          <input class="field-input" id="f-trim" name="trimLevel" placeholder="e.g. S, GTS, Turbo" required minlength="1" maxlength="40"/>
          <div class="field-error" id="err-trim"></div>
        </div>
        <div class="field">
          <label class="field-label" for="f-year-in">Year *</label>
          <input class="field-input" id="f-year-in" name="year" type="number" placeholder="2023" required min="1950" max="2030"/>
          <div class="field-error" id="err-year"></div>
        </div>
        <div class="field">
          <label class="field-label" for="f-price-in">Price (€) *</label>
          <input class="field-input" id="f-price-in" name="price" type="number" placeholder="189900" required min="0" step="100"/>
          <div class="field-error" id="err-price"></div>
        </div>
        <div class="field">
          <label class="field-label" for="f-color-in">Color *</label>
          <input class="field-input" id="f-color-in" name="color" placeholder="e.g. Guards Red" required/>
          <div class="field-error" id="err-color"></div>
        </div>
        <div class="field">
          <label class="field-label" for="f-mileage">Mileage (km)</label>
          <input class="field-input" id="f-mileage" name="mileageKm" type="number" placeholder="0" min="0"/>
          <div class="field-error" id="err-mileage"></div>
        </div>
        <div class="field full">
          <label class="field-label" for="f-image">Image URL</label>
          <input class="field-input" id="f-image" name="imageUrl" type="url" placeholder="https://example.com/car.jpg" maxlength="500"/>
          <div class="field-error" id="err-image"></div>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-submit" id="submit-btn">
            <span id="submit-spinner" style="display:none;"><div class="spinner"></div></span>
            <span id="submit-label">Add Vehicle</span>
          </button>
          <button type="button" class="btn-cancel" onclick="cancelForm()">Cancel</button>
        </div>
      </div>
    </form>
  </div>
  <footer>
    <div class="footer-brand">APEX MOTORS</div>
    <div class="footer-note">Performance Vehicle Registry</div>
  </footer>
</div>

<!-- DELETE MODAL -->
<div class="modal-overlay" id="delete-modal">
  <div class="modal">
    <div class="modal-icon">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
    </div>
    <div class="modal-title">CONFIRM DELETE</div>
    <div class="modal-body" id="delete-modal-body">Are you sure you want to remove this vehicle from the registry? This action cannot be undone.</div>
    <div class="modal-actions">
      <button class="modal-cancel" onclick="closeDeleteModal()">Cancel</button>
      <button class="modal-confirm" onclick="confirmDelete()">Delete Vehicle</button>
    </div>
  </div>
</div>

<!-- TOASTS -->
<div id="toast-container"></div>

<script>
  /* ═══════════════════════════════════════════════
     CONFIG
  ═══════════════════════════════════════════════ */
  const API_BASE = 'http://localhost:8080/api';

  /* ═══════════════════════════════════════════════
     STATE
  ═══════════════════════════════════════════════ */
  let allCars = [];
  let filteredCars = [];
  let currentSort = 'default';
  let editingId = null;
  let deletingId = null;
  let currentDetailId = null;

  /* ═══════════════════════════════════════════════
     API
  ═══════════════════════════════════════════════ */
  async function fetchCars() {
    const res = await fetch(`${API_BASE}/cars`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
  }
  async function fetchCar(id) {
    const res = await fetch(`${API_BASE}/cars/${id}`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
  }
  async function createCar(data) {
    const res = await fetch(`${API_BASE}/cars`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    if (!res.ok) {
      const txt = await res.text();
      throw new Error(txt || `HTTP ${res.status}`);
    }
    return res.json();
  }
  async function updateCar(id, data) {
    const res = await fetch(`${API_BASE}/cars/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    if (!res.ok) {
      const txt = await res.text();
      throw new Error(txt || `HTTP ${res.status}`);
    }
    return res.json();
  }
  async function deleteCar(id) {
    const res = await fetch(`${API_BASE}/cars/${id}`, { method: 'DELETE' });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
  }

  /* ═══════════════════════════════════════════════
     ROUTER
  ═══════════════════════════════════════════════ */
  function showPage(name, data) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));

    const page = document.getElementById(`page-${name}`);
    const navEl = document.getElementById(`nav-${name}`);
    if (page) page.classList.add('active');
    if (navEl) navEl.classList.add('active');
    window.scrollTo({ top: 0, behavior: 'smooth' });

    if (name === 'catalog') loadCatalog();
    if (name === 'home') loadHomeStats();
    if (name === 'detail' && data) openDetail(data);
    if (name === 'add') prepareForm(data);
  }

  /* ═══════════════════════════════════════════════
     HOME STATS
  ═══════════════════════════════════════════════ */
  async function loadHomeStats() {
    try {
      const cars = await fetchCars();
      document.getElementById('stat-count').textContent = cars.length;
      const models = new Set(cars.map(c => c.trimLevel).filter(Boolean));
      document.getElementById('stat-brands').textContent = models.size || cars.length;
    } catch {
      document.getElementById('stat-count').textContent = '—';
      document.getElementById('stat-brands').textContent = '—';
    }
  }

  /* ═══════════════════════════════════════════════
     CATALOG
  ═══════════════════════════════════════════════ */
  async function loadCatalog() {
    showSkeletons();
    try {
      allCars = await fetchCars();
      applyFilters();
    } catch (e) {
      document.getElementById('cars-grid').innerHTML = `
        <div class="empty-state" style="grid-column:1/-1">
          <div class="api-error-banner">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            Unable to connect to API at ${API_BASE}. Make sure your Spring Boot server is running.
          </div>
        </div>`;
      document.getElementById('catalog-count').textContent = 'API offline';
    }
  }

  function showSkeletons() {
    const grid = document.getElementById('cars-grid');
    grid.innerHTML = Array(6).fill(0).map(() => `
      <div class="skel-card skeleton">
        <div class="skel-img"></div>
        <div class="skel-body">
          <div class="skel-line" style="height:10px;width:30%;"></div>
          <div class="skel-line" style="height:28px;width:65%;"></div>
          <div class="skel-line" style="height:52px;width:100%;margin-top:8px;"></div>
          <div class="skel-line" style="height:20px;width:45%;margin-top:8px;"></div>
        </div>
      </div>`).join('');
  }

  function applyFilters() {
    const model    = document.getElementById('f-model')?.value.toLowerCase().trim() || '';
    const yearMin  = parseInt(document.getElementById('f-year-min')?.value) || 0;
    const yearMax  = parseInt(document.getElementById('f-year-max')?.value) || 9999;
    const priceMin = parseFloat(document.getElementById('f-price-min')?.value) || 0;
    const priceMax = parseFloat(document.getElementById('f-price-max')?.value) || Infinity;
    const color    = document.getElementById('f-color')?.value.toLowerCase().trim() || '';

    filteredCars = allCars.filter(c => {
      if (model  && !((c.model||'').toLowerCase().includes(model) || (c.trimLevel||'').toLowerCase().includes(model))) return false;
      if (c.year && (c.year < yearMin || c.year > yearMax)) return false;
      if (c.price != null && (c.price < priceMin || c.price > priceMax)) return false;
      if (color && !(c.color||'').toLowerCase().includes(color)) return false;
      return true;
    });

    sortCars();
    renderCars();
  }

  function clearFilters() {
    ['f-model','f-year-min','f-year-max','f-price-min','f-price-max','f-color'].forEach(id => {
      const el = document.getElementById(id); if (el) el.value = '';
    });
    applyFilters();
  }

  function setSort(btn, sort) {
    document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentSort = sort;
    sortCars(); renderCars();
  }

  function sortCars() {
    filteredCars = [...filteredCars];
    if (currentSort === 'price-asc')  filteredCars.sort((a,b) => (a.price||0) - (b.price||0));
    if (currentSort === 'price-desc') filteredCars.sort((a,b) => (b.price||0) - (a.price||0));
    if (currentSort === 'year-desc')  filteredCars.sort((a,b) => (b.year||0) - (a.year||0));
  }

  function renderCars() {
    const grid = document.getElementById('cars-grid');
    const count = document.getElementById('catalog-count');
    const viewCount = document.getElementById('view-count');

    count.textContent = `${allCars.length} vehicles`;
    viewCount.textContent = `Showing ${filteredCars.length} of ${allCars.length}`;

    if (!filteredCars.length) {
      grid.innerHTML = `
        <div class="empty-state">
          ${carSVG(80)}
          <div class="empty-title">NO VEHICLES FOUND</div>
          <div class="empty-sub">Try adjusting your filters or add a new vehicle to the collection.</div>
          <button class="btn-primary" style="margin-top:8px" onclick="showPage('add')">Add Vehicle</button>
        </div>`;
      return;
    }

    grid.innerHTML = filteredCars.map((car, i) => buildCard(car, i)).join('');
  }

  function buildCard(car, i) {
    const price = car.price != null ? '€' + car.price.toLocaleString() : 'N/A';
    const colorHex = colorToHex(car.color);
    const delay = Math.min(i * 60, 400);

    const imageHTML = car.imageUrl
      ? `<img class="card-image" src="${escHtml(car.imageUrl)}" alt="${escHtml(car.model||'')}" loading="lazy" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"/>
         <div class="card-image-placeholder" style="display:none">${carSVG(60)}</div>`
      : `<div class="card-image-placeholder" style="display:flex">${carSVG(60)}</div>`;

    return `
      <div class="car-card" style="animation-delay:${delay}ms" onclick="showPage('detail', ${car.id})" tabindex="0" role="button" aria-label="View ${car.model||'car'} details"
           onkeydown="if(event.key==='Enter')showPage('detail',${car.id})">
        <div class="card-image-wrap">
          ${imageHTML}
          <div class="card-badge">${escHtml(car.trimLevel||'')}</div>
        </div>
        <div class="card-body">
          <div class="card-year">${car.year||''}</div>
          <div class="card-model">${escHtml(car.model||'N/A')}</div>
          <div class="card-trim">${escHtml(car.trimLevel||'')}</div>
          <div class="card-specs">
            <div class="spec-item">
              <div class="spec-val">${car.year||'—'}</div>
              <div class="spec-key">Year</div>
            </div>
            <div class="spec-item">
              <div class="spec-val">${car.mileageKm != null ? car.mileageKm.toLocaleString() : '—'}</div>
              <div class="spec-key">km</div>
            </div>
            <div class="spec-item">
              <div class="spec-val">${escHtml(car.color||'—')}</div>
              <div class="spec-key">Color</div>
            </div>
          </div>
          <div class="card-footer">
            <div class="card-price">${price}</div>
            <div style="display:flex;align-items:center;gap:8px">
              <div class="card-color">
                <div class="color-dot" style="background:${colorHex}"></div>
                ${escHtml(car.color||'')}
              </div>
              <div class="card-arrow">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
              </div>
            </div>
          </div>
        </div>
      </div>`;
  }

  /* ═══════════════════════════════════════════════
     DETAIL
  ═══════════════════════════════════════════════ */
  async function openDetail(id) {
    currentDetailId = id;
    let car = allCars.find(c => c.id === id);
    if (!car) {
      try { car = await fetchCar(id); } catch { showToast('Error', 'Could not load vehicle', 'error'); showPage('catalog'); return; }
    }
    renderDetail(car);
  }

  function renderDetail(car) {
    const heroImg  = document.getElementById('detail-hero-img');
    const heroPh   = document.getElementById('detail-hero-placeholder');
    if (car.imageUrl) {
      heroImg.src = car.imageUrl; heroImg.style.display = 'block'; heroPh.style.display = 'none';
      heroImg.onerror = () => { heroImg.style.display='none'; heroPh.style.display='flex'; };
    } else {
      heroImg.style.display = 'none'; heroPh.style.display = 'flex';
    }

    document.getElementById('detail-year').textContent  = car.year || '';
    document.getElementById('detail-model').textContent = car.model || 'Unknown';
    document.getElementById('detail-trim').textContent  = car.trimLevel || '';
    document.getElementById('detail-price').textContent = car.price != null ? '€' + car.price.toLocaleString() : 'N/A';

    const specs = [
      ['Model', car.model], ['Trim Level', car.trimLevel], ['Year', car.year],
      ['Price', car.price != null ? '€'+car.price.toLocaleString() : null],
      ['Color', car.color], ['Mileage', car.mileageKm != null ? car.mileageKm.toLocaleString()+' km' : null],
      ['ID', car.id]
    ].filter(([,v]) => v != null);

    document.getElementById('detail-specs').innerHTML = specs.map(([k,v]) => `
      <div class="spec-cell">
        <div class="spec-cell-key">${k}</div>
        <div class="spec-cell-val">${escHtml(String(v))}</div>
      </div>`).join('');

    document.getElementById('btn-edit').onclick = () => showPage('add', { edit: true, car });
    document.getElementById('btn-delete-detail').onclick = () => openDeleteModal(car.id, car.model);
  }

  /* ═══════════════════════════════════════════════
     FORM
  ═══════════════════════════════════════════════ */
  function prepareForm(data) {
    editingId = null;
    const form = document.getElementById('car-form');
    form.reset();
    clearFieldErrors();
    document.getElementById('form-error').style.display = 'none';
    document.getElementById('submit-label').textContent = 'Add Vehicle';
    document.getElementById('form-title').textContent = 'ADD VEHICLE';

    if (data?.edit && data.car) {
      editingId = data.car.id;
      const car = data.car;
      document.getElementById('form-title').textContent = 'EDIT VEHICLE';
      document.getElementById('submit-label').textContent = 'Save Changes';
      form.querySelector('[name=model]').value       = car.model || '';
      form.querySelector('[name=trimLevel]').value   = car.trimLevel || '';
      form.querySelector('[name=year]').value        = car.year || '';
      form.querySelector('[name=price]').value       = car.price || '';
      form.querySelector('[name=color]').value       = car.color || '';
      form.querySelector('[name=mileageKm]').value   = car.mileageKm || '';
      form.querySelector('[name=imageUrl]').value    = car.imageUrl || '';
    }
  }

  function clearFieldErrors() {
    ['err-model','err-trim','err-year','err-price','err-color','err-mileage','err-image'].forEach(id => {
      const el = document.getElementById(id); if (el) el.textContent = '';
    });
    document.querySelectorAll('.field-input.error').forEach(el => el.classList.remove('error'));
  }

  function validateForm(data) {
    const errors = {};
    if (!data.model || data.model.length < 2) errors.model = 'Model must be at least 2 characters';
    if (!data.trimLevel || data.trimLevel.length < 1) errors.trimLevel = 'Trim level is required';
    if (!data.year || data.year < 1950 || data.year > 2030) errors.year = 'Year must be between 1950 and 2030';
    if (data.price == null || data.price < 0) errors.price = 'Price must be 0 or greater';
    if (!data.color) errors.color = 'Color is required';
    if (data.mileageKm != null && data.mileageKm < 0) errors.mileageKm = 'Mileage cannot be negative';
    return errors;
  }

  async function submitCar(e) {
    e.preventDefault();
    clearFieldErrors();
    document.getElementById('form-error').style.display = 'none';

    const form = e.target;
    const fd = new FormData(form);
    const data = {
      model:      fd.get('model')?.trim(),
      trimLevel:  fd.get('trimLevel')?.trim(),
      year:       fd.get('year') ? parseInt(fd.get('year')) : null,
      price:      fd.get('price') ? parseFloat(fd.get('price')) : null,
      color:      fd.get('color')?.trim(),
      mileageKm:  fd.get('mileageKm') ? parseInt(fd.get('mileageKm')) : null,
      imageUrl:   fd.get('imageUrl')?.trim() || null
    };

    const errors = validateForm(data);
    if (Object.keys(errors).length) {
      const fieldMap = { model:'err-model', trimLevel:'err-trim', year:'err-year', price:'err-price', color:'err-color', mileageKm:'err-mileage', imageUrl:'err-image' };
      for (const [key, msg] of Object.entries(errors)) {
        const el = document.getElementById(fieldMap[key]); if (el) el.textContent = msg;
        const inp = form.querySelector(`[name=${key}]`); if (inp) inp.classList.add('error');
      }
      return;
    }

    const btn = document.getElementById('submit-btn');
    btn.disabled = true;
    document.getElementById('submit-spinner').style.display = 'flex';

    try {
      if (editingId) {
        await updateCar(editingId, data);
        showToast('Updated', `${data.model} has been updated`, 'success');
      } else {
        await createCar(data);
        showToast('Added', `${data.model} ${data.trimLevel} added to collection`, 'success');
      }
      // Refresh cars list
      allCars = await fetchCars();
      showPage('catalog');
    } catch (err) {
      const errDiv = document.getElementById('form-error');
      errDiv.innerHTML = `<div class="api-error-banner">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        ${escHtml(err.message || 'An error occurred. Please try again.')}
      </div>`;
      errDiv.style.display = 'block';
      showToast('Error', err.message || 'Failed to save vehicle', 'error');
    } finally {
      btn.disabled = false;
      document.getElementById('submit-spinner').style.display = 'none';
    }
  }

  function cancelForm() {
    if (editingId && currentDetailId) {
      showPage('detail', currentDetailId);
    } else {
      showPage('catalog');
    }
  }

  /* ═══════════════════════════════════════════════
     DELETE MODAL
  ═══════════════════════════════════════════════ */
  function openDeleteModal(id, model) {
    deletingId = id;
    document.getElementById('delete-modal-body').textContent =
      `Are you sure you want to remove "${model || 'this vehicle'}" from the registry? This action cannot be undone.`;
    document.getElementById('delete-modal').classList.add('open');
  }
  function closeDeleteModal() {
    document.getElementById('delete-modal').classList.remove('open');
    deletingId = null;
  }
  async function confirmDelete() {
    if (!deletingId) return;
    try {
      await deleteCar(deletingId);
      allCars = allCars.filter(c => c.id !== deletingId);
      closeDeleteModal();
      showToast('Deleted', 'Vehicle removed from collection', 'info');
      showPage('catalog');
    } catch (err) {
      closeDeleteModal();
      showToast('Error', err.message || 'Failed to delete vehicle', 'error');
    }
  }
  document.getElementById('delete-modal').addEventListener('click', e => {
    if (e.target === e.currentTarget) closeDeleteModal();
  });

  /* ═══════════════════════════════════════════════
     TOASTS
  ═══════════════════════════════════════════════ */
  function showToast(title, msg, type = 'info') {
    const icons = {
      success: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#2dd4a0" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>`,
      error:   `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#e63312" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`,
      info:    `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#c9a84c" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`
    };
    const container = document.getElementById('toast-container');
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.innerHTML = `<div class="toast-icon">${icons[type]||icons.info}</div>
      <div class="toast-content">
        <div class="toast-title">${escHtml(title)}</div>
        <div class="toast-msg">${escHtml(msg)}</div>
      </div>`;
    container.appendChild(t);
    setTimeout(() => {
      t.style.animation = 'toastOut 0.35s var(--ease) forwards';
      setTimeout(() => t.remove(), 350);
    }, 3800);
  }

  /* ═══════════════════════════════════════════════
     UTILITIES
  ═══════════════════════════════════════════════ */
  function escHtml(str) {
    return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  function colorToHex(name) {
    const map = {
      'red':'#c0392b','guards red':'#c0392b','red metallic':'#c0392b',
      'blue':'#2980b9','blue metallic':'#2980b9','gentian blue':'#1a3a6b','miami blue':'#006dff','shark blue':'#1b5e87',
      'white':'#e8e8e8','white silver':'#d0d0d0','carrara white':'#f0f0f0',
      'black':'#1a1a1a','jet black':'#111','black metallic':'#222',
      'silver':'#a0a0a0','silver metallic':'#b8b8b8','gt silver':'#c0c0c0',
      'green':'#27ae60','mamba green':'#2e7d32','python green':'#4caf50',
      'yellow':'#f1c40f','racing yellow':'#ffd700','signal yellow':'#ffc107',
      'orange':'#e67e22','lava orange':'#e64a19',
      'grey':'#666','agate grey':'#777','slate grey':'#708090',
      'gold':'#c9a84c','mahogany':'#7b3f00',
      'purple':'#8e44ad','amethyst':'#9b59b6'
    };
    const key = (name||'').toLowerCase();
    for (const [k,v] of Object.entries(map)) if (key.includes(k)) return v;
    return '#555';
  }

  function carSVG(size=60) {
    return `<svg width="${size}" height="${size*0.5}" viewBox="0 0 120 60" fill="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="60" cy="38" rx="54" ry="14" fill="rgba(255,255,255,0.06)"/>
      <rect x="18" y="22" width="84" height="20" rx="5" fill="rgba(255,255,255,0.08)"/>
      <path d="M28 22 L38 8 L80 8 L94 22" fill="rgba(255,255,255,0.06)" stroke="rgba(255,255,255,0.15)" stroke-width="1"/>
      <circle cx="34" cy="44" r="9" fill="rgba(255,255,255,0.04)" stroke="rgba(255,255,255,0.15)" stroke-width="1.5"/>
      <circle cx="34" cy="44" r="4" fill="rgba(255,255,255,0.08)"/>
      <circle cx="86" cy="44" r="9" fill="rgba(255,255,255,0.04)" stroke="rgba(255,255,255,0.15)" stroke-width="1.5"/>
      <circle cx="86" cy="44" r="4" fill="rgba(255,255,255,0.08)"/>
    </svg>`;
  }

  /* ═══════════════════════════════════════════════
     KEYBOARD NAV
  ═══════════════════════════════════════════════ */
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeDeleteModal();
  });

  /* ═══════════════════════════════════════════════
     INIT
  ═══════════════════════════════════════════════ */
  loadHomeStats();
</script>
</body>
</html>